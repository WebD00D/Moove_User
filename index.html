<!DOCTYPE html>
<html>
 <head>

  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0"/>
  <title>Moove | What's the moove?</title>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link type="text/css" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.1/css/materialize.min.css">
  <link type="text/css" rel="stylesheet" href="css/moove.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">

 </head>
  <body style="background-color:#21282F;">

    <div id="preloader">
      <div class="spinner">
         <div class="double-bounce1"></div>
         <div class="double-bounce2"></div>
      </div>
    </div>


<div class="col s12" style="position:relative;background:linear-gradient(rgba(01,01,01,0.6),rgba(01,01,01,0.6)),url(http://plusmgt.com/wp-content/gallery/richmond/richmond-pre-dawn-for-dill-ad.jpg);background-position-x:22%;background-position-y:22%;height:200px">

  <nav role="navigation"  style="height:70px;background-color:rgba(01,01,01,0.0);box-shadow:none">
   <div class="nav-wrapper container" style="margi-top:0px">
     <ul id="nav-mobile" class="side-nav" style="background-color:black">
       <img style="margin-top:10%;margin-left:10%" height="60px" src="MooveBrand.png">
       <li><a style="font-size:large;font-weight:200" class="white-text " href="#">About</a></li>
           <hr class="teal" style=";border:none;height:1px;">

       <li><a style="font-size:large;font-weight:200" class="white-text " href="#">Sign Out</a></li>
       <hr class="teal" style=";border:none;height:1px;">
     </ul>
     <a id="navMobile" href="#" data-activates="nav-mobile" class="button-collapse white-text"><img style="margin-top:45%;" height="50px" src="MooveCircle.png"></a>
     <span class="white-text right"><b id="MooveDay"></b></span>
   </div>
 </nav>
  <div style="position:absolute;bottom:0;padding-left:5%" class="white-text"><h3><b>VCU / FAN</b></h3></div>
</div>



<div class="col s12" style="background-color:#21282F;padding:10px;padding-left:5%;padding-right:5%;padding-bottom:10%">
  <div id="mooveContainer">

    <ul class="collection with-header" style="border:none;">
      <li class="collection-header teal" style="padding-top:5px;border-bottom:1px solid #cbcbcb">
        <span><h5 class="white-text"><b>Postbellum</b><a href="#!" class="secondary-content"><i class="material-icons teal-text text-darken-3">thumb_down</i><span style="padding-left:5px;color:#cbcbcb">35</span></a><a href="#!" class=" secondary-content" style="margin-left:10px"><i class="material-icons teal-text text-darken-3">thumb_up</i><span style="padding-right:10px;padding-left:3px;color:#cbcbcb">44</span></a></h5></span>
      </li>
      <li class="collection-item" style="padding-left:0px;padding-right:0px;padding-top:0px">
        <ul class="collection" style="border:none;overflow-y:scroll;max-height:150px;margin-top:0px">
          <li class="collection-item"><i class="fa fa-quote-left pink-text"></i>
            <span>Placf ghfj dggfh gfhe is poppin tonfghf ghgfh  fghfgh  fghight!</span>
            <br><span class="pink-text" style="font-style:italic;font-weight:400"><small>- 5 min ago</small></span>
          </li>
          <li class="collection-item"><i class="fa fa-quote-left pink-text"></i>
            <span>Placf ghfj dggfh gfhe is poppin tonfghf ghgfh  fghfgh  fghight!</span>
            <br><span class="pink-text" style="font-style:italic;font-weight:400"><small>- 5 min ago</small></span>
          </li>
          <li class="collection-item"><i class="fa fa-quote-left pink-text"></i>
            <span>Placf ghfj dggfh gfhe is poppin tonfghf ghgfh  fghfgh  fghight!</span>
            <br><span class="pink-text" style="font-style:italic;font-weight:400"><small>- 5 min ago</small></span>
          </li>
          <li class="collection-item"><i class="fa fa-quote-left pink-text"></i>
            <span>Placf ghfj dggfh gfhe is poppin tonfghf ghgfh  fghfgh  fghight!</span>
            <br><span class="pink-text" style="font-style:italic;font-weight:400"><small>- 5 min ago</small></span>
          </li>

        </ul>
      </li>
    </ul>


  </div>
</div>


  <script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.1/js/materialize.min.js"></script>
  <script src="https://www.parse.com/downloads/javascript/parse-1.6.7.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/js-cookie/2.0.4/js.cookie.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert-dev.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/datejs/1.0/date.min.js"></script>
  <script src="js/url.js"></script>



  <script>

    $(window).load(function(){
    $('#preloader').fadeOut('slow',function(){$(this).remove();});
    });

  $(document).ready(function(){

    Parse.initialize("JcVNtENTjHAn2pOrldHR7pnDj2dnaqzm5zhKxE37", "6qnbKsBLmRvpa6ksobU7NuYv2haPtzWVf8jzYs0c");
    $('.button-collapse').sideNav();

    getMooveDay();
    loadMooves();

    function getMooveDay(){
        var theDay = Date.today();
        $("#MooveDay").text("#"+ theDay.toString('dddd')+ "Mooves");
    }

    function loadMooves(){
      //...just load mooves for VCU/FAN area
      $("#mooveContainer").empty();
      var Destinations = Parse.Object.extend("Destinations");
      var query = new Parse.Query(Destinations);
      query.equalTo("Area", "VCU/Fan");
      query.descending("MooveCount");
      query.find({
          success:function(results){
              for (var i = 0; i < results.length; i++) {
                var object = results[i];
                var destination = new Destinations();
                var destinationID = object.id;

                var promo = object.get("theSpecial");
                if (typeof promo === 'undefined' || promo === ''){
                  promo = '...';
                }


                var content = "<ul class='collection with-header' style='border:none;margin-bottom:0px'>"+

                "<li class='collection-header teal' style='padding-top:5px;border-bottom:1px solid #cbcbcb;;padding-bottom:0px;padding-left:0px;padding-right:0px'><span><h6 style='padding-left:10px;padding-right:10px;padding-bottom:5px' class='white-text'><b>"+ object.get("Name") +"</b><a href=''#!' class='secondary-content'><i style='font-size:18px' class='material-icons teal-text text-darken-3'>thumb_down</i><span style='padding-left:5px;color:#cbcbcb'><span id='Down"+ object.id +"'></span></span></a><a href='#!' class='secondary-content' style='margin-left:10px'><i  style='font-size:18px' class='material-icons teal-text text-darken-3'>thumb_up</i><span style='padding-right:10px;padding-left:3px;color:#cbcbcb'><span id='Up"+ object.id +"'></span></span></a></h6></span><div class='teal darken-1' style='padding:5px;padding-left:10px' ><b>"+ promo +"</b></div></li>"+
                "<li><ul class='"+ object.id +" collection'  style='border:none;overflow-y:scroll;max-height:150px;margin-top:0px;margin-bottom:0px' ></ul></li></ul>"+


                $(content).appendTo("#mooveContainer");
                getComments(destinationID);

              }
          }
      })

    } // end loadMooves

    function getComments(parent){

      console.log("about to check review for... "+ parent);
      var Reviews = Parse.Object.extend("Reviews");
      var Destination = Parse.Object.extend("Destinations");
          var destination = new Destination();
              destination.id = parent;
                var query = new Parse.Query(Reviews);
                    query.equalTo("DestinationID", destination);
                        query.find({
                          success: function(results) {
                            // comments now contains the comments for posts without images.

                            var MooveOnCount = 0;
                            var MooveCount = 0;
                              for (var i = 0; i < results.length; i++) {

                                var object = results[i];

                                var datetime = object.get('createdAt');
                                var reviewYear = datetime.getFullYear();
                                var reviewMonth = datetime.getMonth() + 1;
                                var reviewDay = datetime.getDate();
                                var reviewHours = datetime.getHours(); //returns 0-23
                                var reviewMinutes = datetime.getMinutes(); //returns 0-59

                                var today = new Date();
                                var todaysYear = today.getFullYear();
                                var todaysMonth = today.getMonth() +1;
                                var todaysday = today.getDate();

                                var currentTime = new Date(todaysYear + '/' + todaysMonth + '/' + todaysday + ' ' + today.getHours() + ':' + today.getMinutes());
                              //  console.log(currentTime);
                                var commentTime = new Date(reviewYear + '/' + reviewMonth + '/' + reviewDay + ' ' + reviewHours + ':' + reviewMinutes);
                                var difference = currentTime.getTime() - commentTime.getTime(); // This will give difference in milliseconds

                                var resultInMinutes = Math.round(difference / 60000);
                              //  console.log('total minutes' + resultInMinutes);
                              //  console.log('total hours' + Math.floor(resultInMinutes / 60));
                              //  console.log('remaining minutes' +  resultInMinutes % 60);


                                var totalhours = Math.floor( resultInMinutes / 60 );
                                var remainingMinutes = resultInMinutes % 60


                                if (totalhours === 0){
                                  if (remainingMinutes < 1){
                                    timetext = 'just now..' ;
                                  } else {
                                    if (remainingMinutes === 1){
                                     timetext = remainingMinutes + ' minute ago..' ;
                                   }
                                   else {
                                     timetext = remainingMinutes + ' minutes ago..' ;
                                   }
                                  }
                                } else {

                                  if ( reviewMinutes === 0 ){
                                    if (totalhours === 1){
                                      timetext = totalhours + ' hour ago..';
                                    } else {
                                      timetext = totalhours + ' hours ago..';
                                    }

                                  } else {
                                    if (totalhours === 1){
                                        if (remainingMinutes === 1){
                                          timetext = totalhours + ' hour, ' + remainingMinutes + ' minute ago..';
                                        } else {
                                          timetext = totalhours + ' hour, ' + remainingMinutes + ' minutes ago..';
                                        }

                                    } else {
                                        timetext = totalhours + ' hours, ' + remainingMinutes + ' minutes ago..';
                                    }

                                  }
                                }




                                var content =   "<li class='collection-item'><i class='fa fa-quote-left pink-text'></i>"+
                                                "  <span>"+ object.get("Review") +"</span> " +
                                                "  <br><span class='pink-text' style='font-style:italic;font-weight:400'><small>- "+ timetext +"</small></span>  " +
                                                "</li>"

                                $(content).appendTo("."+parent);

                                var MadeMoove = object.get("MadeMoove");

                                if (MadeMoove){
                                  MooveCount++;
                                } else {
                                  MooveOnCount++;
                                }

                              } //...end loop

                              // .. append the moove counters for destination...
                              $("#Down"+parent).text(MooveOnCount);
                              $("#Up"+parent).text(MooveCount);


                          }
                        });
    } // end getComments








  }) // end doc ready



  </script>

 </body>
</html>
