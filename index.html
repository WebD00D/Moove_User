<!DOCTYPE html>
<html>
 <head>

  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0"/>
  <title>Moove | What's the moove?</title>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link type="text/css" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.1/css/materialize.min.css">
  <link type="text/css" rel="stylesheet" href="css/moove.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.css">

 </head>
  <body style='background:linear-gradient( rgba(01,01,01,1.0),rgba(01,01,01,0.6)100%),url(http://www.abstract-living.com/wp-content/uploads/2015/05/bar-scene.jpg)'>

   <div class="navbar-fixed">
   <nav role="navigation"  style="height:70px;background-color:rgba(01,01,01,0.0);box-shadow:none">
    <div class="nav-wrapper container" >
      <a id="logo-container" style="font-family:'Estilo-regular';font-weight:700;color:#ED4877" href="#" class="brand-logo hide-on-small-only">   <img style="margin-top:10%;" height="75px" src="MooveBrand.png"></a>
        <a id="logo-container" style="font-family:'Estilo-regular';font-weight:700;color:#ED4877" href="#" class="brand-logo hide-on-med-and-up">   <img style="margin-top:25%;" height="100px" src="MooveCircle.png"></a>
      <ul class="right hide-on-med-and-down" style="margin-top:3%">

          <li><a class="white-text" href="index.html" style="font-weight:200">Select Location</a></li>
          <!--
          <li><a class="white-text" href="#" style="font-weight:200">Learn More</a></li>
          <li><a class="white-text" href="#" style="font-weight:200">Connect</a></li> -->

      </ul>

      <ul id="nav-mobile" class="side-nav  " style="background-color:black">
        <img style="margin-top:10%;margin-left:10%" height="60px" src="MooveBrand.png">
        <li><a style="font-size:large;font-weight:200" class="white-text " href="index.html">Select Location</a></li>
        <hr class="teal" style=";border:none;height:1px;">
      </ul>
      <a id="navMobile" href="#" data-activates="nav-mobile" class="button-collapse white-text"><i class="material-icons">menu</i></a>
    </div>
  </nav>
</div>

<div id="index-banner" class="parallax-container" >
 <div class="section no-pad-bot">
   <div class="container">
     <br><br>

     <div class="row center" style="margin-top:10%">
       <h3 class="center-align white-text hide-on-small-only" style="font-weight:200"><b>Make the most of your night out.</b></h3>
        <h5 class="center-align white-text hide-on-med-and-up" style="font-weight:200;margin-top:120px"><b>Make the most of your night out.</b></h5>
     </div>
     <div class="row center">

       <div id="selectLocationSection">

         <label class="center-align " style="color:white;font-size:larger;font-weight:200">Where are you looking to go?</label>
         <Br>
          <div class="input-field col l6 m6 offset-m3 offset-l3 s12" >
            <select id="ddlLocationSelect" class="browser-default" >
              <option  value="VCU/Fan">Fan/VCU</option>
              <option  value="Grove">Grove Ave</option>
              <option  value="Bottom">Shockoe Bottom</option>
              <option  value="Cary">Carytown</option>
              <option  value="ShortPump">Short Pump</option>
              <option  value="RVABreweries">Breweries</option>
              <option  value="RVAMusic">Music Venues</option>
            </select>
            <Br>
              <button id="btnWhatstheMove" style="background-color:#ED4877;width:70%;" class="btn waves-effect waves-light pink center btn-large " type="submit" name="action">Find Mooves</button>
            </div>

       </div>

       <div id="signUpForm">
            <label class="center-align " style="color:white;font-size:larger;font-weight:200">
              Sign up with Moove
            </label>
            <Br>
            <div class="input-field col l6 m6 offset-m3 offset-l3 s12">
              <input id="txtPhoneNumber" maxLength="10" type="text" placeholder="10 Digit Phone Number" class="browser-default" style="background-color:rgba(255,255,255,1.0);padding-left:10px;border-radius:4px;font-size:20px;text-align:center">
            </div>
            <Br>
              <button id="btnSignUp" style="background-color:#ED4877;width:70%;" class="btn waves-effect waves-light teal center btn-large " type="submit" name="action">Continue</button>
              <Br>
              <Br>

       </div>

       <div id="varificationForm">
            <label class="center-align " style="color:white;font-size:larger;font-weight:200">
              Enter the varification code sent below
            </label>
            <Br>
            <div class="input-field col l6 m6 offset-m3 offset-l3 s12">
              <input id="txtCodeEntered" type="text" placeholder="* * * * * *" maxLength="6" class="browser-default" style="background-color:rgba(255,255,255,1.0);padding-left:10px;border-radius:4px;font-size:20px;text-align:center">
            </div>
            <Br>
        <button id="btnVarifyCode" style="background-color:#ED4877;width:70%;" class="btn waves-effect waves-light teal center btn-large " type="submit" name="action">Continue</button>
       </div>




     </div>

     <br><br>

   </div>
 </div>

</div>








  <script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.1/js/materialize.min.js"></script>
  <script src="https://www.parse.com/downloads/javascript/parse-1.6.7.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/js-cookie/2.0.4/js.cookie.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert-dev.min.js"></script>
  <script src="js/url.js"></script>
  <script>

  $(document).ready(function(){

    $('.button-collapse').sideNav();
    $("#selectLocationSection").hide();
    $("#signUpForm").hide();
    $("#varificationForm").hide();
    $("#navMobile").hide();

    var isMooveUser = Cookies.get('isMooveUser');

    if (typeof(isMooveUser) === 'undefined'){
      //show sign up forms
      $("#signUpForm").show();
    } else {
      //show destination form
      // we need to check and make sure that all users have been varified and logged in.

                Parse.initialize("JcVNtENTjHAn2pOrldHR7pnDj2dnaqzm5zhKxE37", "6qnbKsBLmRvpa6ksobU7NuYv2haPtzWVf8jzYs0c");
                var currentUser = Parse.User.current();
                //currentUser = 'hi';
                if (currentUser === null){

                  swal({   title: "We've made updates!",
                  text: "We're sorry, but we need you to confirm your phone number just one more time!",
                  type: "input",
                  showCancelButton: false,
                  closeOnConfirm: false,
                  confirmButtonColor: "#009688",
                  confirmButtonText: "Submit",
                  animation: "slide-from-top",
                  inputPlaceholder: "Your 10 digit phone number..." },
                  function(inputValue){
                    if (inputValue === false) return false;
                    if (inputValue === "") {
                      swal.showInputError("Looks like a phone number is missing!");
                      return false
                     }
                    if (inputValue.length < 10){
                      swal.showInputError("Please enter a 10 digit phone number.");
                      return false
                    }
                    if (inputValue.length > 10){
                      swal.showInputError("Please enter a 10 digit phone number.");
                      return false
                    }
                    if (!$.isNumeric(inputValue)){
                      swal.showInputError("Please enter only numeric values.");
                      return false
                    }
                      //okay now that the number is valid we need to login the user.
                      Parse.User.logIn(inputValue, inputValue, {
                        success: function(user) {
                          Cookies.set('MooveUser', inputValue, { expires: 1000 });
                          swal({   title: "Got it!", type:"success"  ,text: "Now go on and make some Mooves!",   timer: 2000,   showConfirmButton: false });
                        },
                        error: function(user, error) {
                          // The login failed. Check error to see why.
                          swal("Invalid Login!", "Please try again or contact support.", "error");
                        }
                      });

                    });

                }



      $("#selectLocationSection").show();
    }

    $('#txtPhoneNumber').keypress(function(key) {
       if(key.charCode < 48 || key.charCode > 57) return false;
   });


    $("#btnSignUp").click(function(){
      Parse.initialize("JcVNtENTjHAn2pOrldHR7pnDj2dnaqzm5zhKxE37", "6qnbKsBLmRvpa6ksobU7NuYv2haPtzWVf8jzYs0c");

      var phoneNumber = $("#txtPhoneNumber").val();
      if (phoneNumber.length === 10){

        // phone number is good so far. Good to send varification code.
        // Cloud code with Twillio

        var last3 = phoneNumber.substr(phoneNumber.length - 3);
        var theDate = new Date();
        var theYear = theDate.getFullYear() + '';
        var first3 = theYear.substr(theYear.length - 3);
        var theCode = first3 + ' ' + last3;
        var codeNotFormatted = first3 + '' + last3;


        Parse.Cloud.run('sendText', { phoneNumber: '+1' + phoneNumber,verificationCode:theCode }, {
          success: function(response) {
          },
          error: function(error) {
          }
        });

        $("#signUpForm").hide();
        $("#varificationForm").show();
        $("#btnVarifyCode").attr("data-code",codeNotFormatted);
        $("#btnVarifyCode").attr("data-number",phoneNumber);


      } else {
        //invalid phone number
        $("#btnSignUp").removeClass("teal").addClass("red");
        $("#btnSignUp").text("Invalid Number");
      }
    })

    $("#btnVarifyCode").click(function(e){
      var codeSent = $(this).attr('data-code');
      var codeEntered = $("#txtCodeEntered").val();
      var phone = $(this).attr('data-number');

      if (codeEntered !== codeSent){
        //invalid phone number
        $("#btnVarifyCode").removeClass("teal").addClass("red");
        $("#btnVarifyCode").text("Invalid Code");
      } else {
        // Create New Parse User then show them to the welcome screen, set cookie and show menu.
        Parse.User.logOut();
        var user = new Parse.User();
        user.set("username", phone);
        user.set("password", phone);
        user.signUp(null, {
        success: function(user) {
          // Hooray! Let them use the app now.
          $("#varificationForm").hide();
          $("#selectLocationSection").show();
          Cookies.set('isMooveUser', 'yes', { expires: 1000 });
          Parse.User.logIn(phone, phone, {
            success: function(user) {
              Cookies.set('MooveUser', phone, { expires: 1000 });
            },
            error: function(user, error) {
              // The login failed. Check error to see why.
            }
          });

        },
        error: function(user, error) {
          // Show the error message somewhere and let the user try again.
          console.log("Error: " + error.code + " " + error.message);
        }
      });

      }
    }) // end btnVarifyCode click event


    $("#btnWhatstheMove").click(function(){
        selectedLocation = $("#ddlLocationSelect option:selected").val();
        window.location.href = "https://webD00D.github.io/Moove_User/theMoove.html?location=" + selectedLocation;
    })

  })

  </script>

 </body>
</html>
