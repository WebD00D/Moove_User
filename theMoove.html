<!DOCTYPE html>
<html>
 <head>

  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0"/>
  <title>Moove | What's the moove?</title>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link type="text/css" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.1/css/materialize.min.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.css">
  <link type="text/css" rel="stylesheet" href="css/animsition.css">
  <link type="text/css" rel="stylesheet" href="css/moove.css">
  <script src="https://use.typekit.net/fpd5bbp.js"></script>
  <script>try{Typekit.load({ async: true });}catch(e){}</script>
 </head>
 <body style='background-color:black'>

   <div class="animsition">
     <div class="navbar-fixed">
       <nav role="navigation"  style="background-color:rgba(01,01,01,1.0);box-shadow:none">
        <div class="nav-wrapper container" >

            <a id="logo-container" style="font-family:'Estilo-regular';font-weight:700;color:#ED4877" href="#" class="brand-logo hide-on-med-and-up ">   <img style="margin-top:25%;" height="60px" src="MooveCircle.png"></a>



        </div>
      </nav>
  </div>




  <div class="section no-pad-bot mainview" id="index-banner">
    <div class="container">


      <div class="row destinations left-align" style="margin-top:7%;max-height:74vh;overflow-y:scroll;">






      </div>

      <div id="loadingMooves" class="progress">
          <div class="indeterminate"></div>
      </div>

 </div>


 <div id="footer" style="padding-left:10px;padding-right:10px;background-color:white">

   <div class="row center-align" style="margin-bottom:0px">

     <div id="goToLocations" class="col s3" style="padding:6px">
       <i style="font-size:30px" class="material-icons teal-text">location_on</i>
       <Br>
       <label>Locations</label>
     </div>
     <div id="goToReview" class="col s3" style="padding:6px">
       <i style="font-size:30px" class="material-icons teal-text">rate_review</i>
       <Br>
       <label>Review</label>
     </div>
     <div class="col s3 comingsoon" style="padding:6px">
       <i style="font-size:30px" class="material-icons teal-text">local_play</i>
       <Br>
       <label>Points</label>
     </div>
     <div class="col s3 comingsoon" style="padding:6px">
       <i style="font-size:30px;" class="material-icons teal-text">redeem</i>
       <Br>
       <label>Redeem</label>
     </div>


   </div>







 </div>





 <!-- Modal Structure -->
<div id="modal1" class="modal bottom-sheet" style="min-height:235px;padding-top:0px;margin-top:0px">
  <div id="modaldiv" class="col s12 teal center-align" style="padding:10px">

    <label style='color:white;margin-left:30px'><span id="modalMessage"> Leave a review or rating</span> </label> <i id="closeReviewModal"  class="material-icons right white-text" style="margin-left:0px">close</i>
  </div>
  <div id="mooveProgress" class="progress" style="margin-top:0px">
      <div class="indeterminate"></div>
  </div>
  <div class="modal-content center-align" style="padding:10px">

    <div class="input-field col s6 l6" style="margin-top:0px">

      <select id="ddlLocalDestinations" class="browser-default" >
        <option value="" disabled selected>Select a destination</option>

      </select>

    </div>

    <div class="input-field col s6 l6">

         <input id="input_text" placeholder="Have anything to say?" type="text" maxlength="40" length="40">
         <a href="index.html" id="errorIcon" style="background-color:#E57373" class="btn btn-large btn-flat waves-effect waves-light white-text" >Back To Locations</a>

       </div>
       <Br>
        <div class="row">
          <div class="col s12" style="padding:0px">
            <div class="col l6 m6 s6 center-align" style="padding:0px">
              <div class="s12" style="padding:5px">
                <a id="btnMooveOn" href=""  class=" waves-effect btn-large waves-light btn-flat grey lighten-1 center-align white-text " style="width:100%;padding-left:10px;padding-right:10px"><i style="font-size:20px" class="fa fa-thumbs-o-down white-text"></i> Moove On </a>
              </div>
            </div>
            <div class="col l6 m6 s6 center-align" style="padding:0px">
              <div class="s12" style="padding:5px">
              <a id="btnMakeMooves" href="" class=" waves-effect waves-light btn-flat btn-large teal  center-align white-text " style="width:100%;padding-left:10px;padding-right:10px"><i style="font-size:20px" class="fa fa-thumbs-o-up white-text "></i> Make Mooves </a>
              </div>
            </div>
          </div>
        </div>
    <Br>
  </div>
</div>



   <script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.1/js/materialize.min.js"></script>
   <script src="https://www.parse.com/downloads/javascript/parse-1.6.7.min.js"></script>
   <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAT6SGmUbd4nfyE8zLN68idFD7Buixx-d4&libraries=geometry" type="text/javascript"></script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert-dev.min.js"></script>
   <script src="js/url.js"></script>
   <script src="js/animsition.js"></script>
   <script src="js/date.js"></script>
   <script src="js/moove.js"></script>

   <script>

    $(document).ready(function(){


      $("#mooveProgress").hide();
      $("#errorIcon").hide();

        var theLocation = url('?location');
        loadLocations(theLocation);

        function loadLocations(area){
          $("#ddlLocalDestinations").empty();
          var Destinations = Parse.Object.extend("Destinations");
          var query = new Parse.Query(Destinations);
          query.equalTo("Area", area);
          query.descending("MooveCount");
          query.find({
          success: function(results) {
            for (var i = 0; i < results.length; i++) {
            var object = results[i];
            var name = object.get('Name');
            var isMoovePartner = object.get('isMoovePartner');
            var pointsNeeded = object.get("pointsNeeded");
            var DestinationLatitude = object.get('Latitude');
            var DestinationLongitude = object.get('Longitude');

            var locationOption = "<option data-who="+ object.id+ " data-pointsNeeded="+ pointsNeeded +" data-isMoovePartner='"+ isMoovePartner +"' data-lon="+ DestinationLongitude +" data-lat="+ DestinationLatitude +">" + name + "</option>"

            if (name != "EMPTY"){
              $(locationOption).appendTo("#ddlLocalDestinations")
            }

          }

          var defaultVal = "<option value='' disabled selected>Select a destination</option>";
          $(defaultVal).prependTo("#ddlLocalDestinations");

         },
          error: function(error) {
          //alert("Error: " + error.code + " " + error.message);
          }
          });
        }

        var latitude,longitude,theObject,moovePartner,pointsNeeded;

        $("#ddlLocalDestinations").change(function(){


          $("#modaldiv").removeClass("red").addClass("teal");
          $("#modaldiv").removeClass("lighten-2");

          var currentUser = Parse.User.current();

          $("#mooveProgress").show();

          latitude = $("#ddlLocalDestinations option:selected").attr("data-lat");
          longitude = $("#ddlLocalDestinations option:selected").attr("data-lon");
          theObject = $("#ddlLocalDestinations option:selected").attr("data-who");
          moovePartner = $("#ddlLocalDestinations option:selected").attr("data-isMoovePartner");
          pointsNeeded = $("#ddlLocalDestinations option:selected").attr("data-pointsNeeded");



          //get users current latitude longitude.
          if ("geolocation" in navigator) {
            /* geolocation is available now we need to get users location */
            checkLocation();

          } else {
            /* geolocation IS NOT available */
            $("#modaldiv").removeClass("teal").addClass("red");
            $("#modaldiv").addClass("lighten-2");
            $("#modalMessage").text("We're having trouble finding your location.");
            return;

          }

        })

        function checkLocation(){

          navigator.geolocation.watchPosition(function(position) {
            // Update latitude and longitude
            userLatitude = position.coords.latitude;
            userLongitude = position.coords.longitude;
          });

          if(typeof userLatitude === 'undefined' || typeof userLongitude === 'undefined') {
             $("#modalMessage").text("Verifying your location...");
             setTimeout(function(){ checkLocation(); }, 500); // Try to submit form after timeout
             return false;
           } else {
             // Continue with location found...
             $("#modalMessage").text("Checking distance from " + $("#ddlLocalDestinations option:selected").text() + '...');
             //now make call to Google API to get distance.
             var origin1 = new google.maps.LatLng(userLatitude, userLongitude);
             var destinationA = new google.maps.LatLng(latitude, longitude);
             var distanceBetween = google.maps.geometry.spherical.computeDistanceBetween(origin1,destinationA)
              console.log(distanceBetween);
              if (distanceBetween > 304.8){ //that's 1000 feet in meters
                $("#mooveProgress").hide();
                $("#modaldiv").removeClass("teal").addClass("red");
                $("#modaldiv").addClass("lighten-2");
                $("#modalMessage").text("Hmm..Looks like you aren't at " +$("#ddlLocalDestinations option:selected").text());
                $("#btnMakeMooves").hide();
                $("#btnMooveOn").hide();
                $("#input_text").hide();
                $("#errorIcon").show()
              } else {
                $("#mooveProgress").hide();
                $("#modaldiv").removeClass("red").addClass("teal");
                $("#modaldiv").removeClass("lighten-2");
                $("#modalMessage").text("What's the Moove for " +$("#ddlLocalDestinations option:selected").text() + "?");
                $("#btnMakeMooves").show();
                $("#btnMooveOn").show();
                $("#btnMakeMooves").attr("data-objectid",theObject);
                $("#btnMooveOn").attr("data-objectid",theObject);
                $("#btnMakeMooves").attr("data-isMoovePartner",moovePartner);
                $("#btnMooveOn").attr("data-isMoovePartner",moovePartner);
                $("#btnMakeMooves").attr("data-pointsNeeded",pointsNeeded);
                $("#btnMooveOn").attr("data-pointsNeeded",pointsNeeded);
                $("#input_text").show();
                $("#errorIcon").hide();

              }

           }
        }





      $("#goToLocations").click(function(){
        window.location.href = "index.html";
      })

      $("#goToReview").click(function(){
        $('#modal1').openModal();
      })

      $("#closeReviewModal").click(function(){
          $('#modal1').closeModal();
      })

      $(".comingsoon").click(function(){

        swal({   title: "Stay tuned!",
        text: "Some cool features are coming soon!",
        confirmButtonColor: "#009688",
        confirmButtonText: "Sweet!", });
      })

    })

   </script>
   <script>
$(document).ready(function() {
$(".animsition").animsition({
inClass: 'fade-in',
outClass: 'fade-out',
inDuration: 1500,
outDuration: 800,
linkElement: '.animsition-link',
// e.g. linkElement: 'a:not([target="_blank"]):not([href^=#])'
loading: true,
loadingParentElement: 'body', //animsition wrapper element
loadingClass: 'animsition-loading',
loadingInner: '', // e.g '<img src="loading.svg" />'
timeout: false,
timeoutCountdown: 5000,
onLoadEvent: true,
browser: [ 'animation-duration', '-webkit-animation-duration'],
// "browser" option allows you to disable the "animsition" in case the css property in the array is not supported by your browser.
// The default setting is to disable the "animsition" in a browser that does not support "animation-duration".
overlay : false,
overlayClass : 'animsition-overlay-slide',
overlayParentElement : 'body',
transition: function(url){ window.location.href = url; }
});
});
</script>



 </div>

 </body>
</html>
